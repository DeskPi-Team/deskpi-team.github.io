<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://wiki.deskpi.com/minipc/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>DeskPi Mini PC - DeskPi Products Wiki</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "DeskPi Mini PC";
        var mkdocs_page_input_path = "minipc.md";
        var mkdocs_page_url = "/minipc/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> DeskPi Products Wiki
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deskpilite_pi5_case/">DeskPi Lite Pi5 Case</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rackmate_t0/">DeskPi RackMate T0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rackmate/">DeskPi RackMate T1</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rackmate_accessories_allinone/">DeskPi RackMate Accessories</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../microcar/">DeskPi MicroCar</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deskpi_lite_nas_case/">DeskPi Lite NAS Case</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../expansionkit/">DeskPi Lite Expansion Kit</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deskpi_lite_for_3b/">DeskPi Lite For Raspberry Pi 3B/3B+</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">DeskPi Mini PC</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#purchase">Purchase</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#description">Description</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#features">Features</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#gallery">Gallery</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#install-ipex-antenna">Install IPEX Antenna</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rtc-battery-information">RTC Battery Information</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#package-includes">Package Includes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-to-assemble-it">How to assemble it</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#optional-install-m2-nvme-ssd-m-key-22422240">[Optional] Install M.2 NVME SSD M-KEY 2242/2240.</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#functionality-of-power-button">Functionality of power button:</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dip-switch-functionality">DIP Switch Functionality</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#dip-switch-pinout">DIP Switch Pinout</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-to-enable-usb20-ports-besides-the-usb-c-port">How to enable USB2.0 ports besides the USB-C port?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-to-update-eeprom-on-cm4-by-using-mini-cube">How to update eeprom on CM4 by using mini cube?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#building">Building</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#macos">macOS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#running">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#compute-module-4-update-the-spi-eeprom-bootloader">Compute Module 4 Update the SPI EEPROM bootloader.</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#booting-linux">Booting Linux</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#hardware">Hardware</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#hardware-cm4">Hardware - CM4</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#software">Software</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#bootcodebin">bootcode.bin</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-to-enable-fan-automatically">How to enable fan automatically?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#official-fan-setting">Official Fan setting</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#control-fan-manually">Control Fan manually</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#demo-code">Demo code</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-to-enable-onboard-rtc-module">How to enable onboard RTC module?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#faq">FAQ</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../picomate/">DeskPi PicoMate</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../super6c/">DeskPi Super6C</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../itxcase/">DeskPi ITX Case Kit for Super6C</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deskpilite/">DeskPi Lite</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deskpinano/">DeskPi Nano</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deskpipro/">DeskPi Pro</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">DeskPi Products Wiki</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>DeskPi Mini PC</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="deskpi-mini-cube">DeskPi Mini Cube</h1>
<ul>
<li>New Product:   ⭐⭐⭐⭐⭐</li>
<li>Compability:    ⭐⭐⭐⭐</li>
<li>Mobility: ⭐⭐⭐⭐⭐</li>
<li>Assemble Difficulty: ⭐</li>
</ul>
<p><img alt="DeskPi Mini Cube" src="../imgs/deskpiminicube/DP-0019-1.jpg" /></p>
<h2 id="purchase">Purchase</h2>
<p><img alt="chart" src="../imgs/picomate/shoppingchart.jpg" /></p>
<p><a href="https://deskpi.com/products/deskpi-mini-cube-for-raspberry-pi-compute-module-4-cm4?_pos=1&amp;_psq=DeskPi%20Cube&amp;_ss=e&amp;_v=1.0">DeskPi Mini Cube</a></p>
<h2 id="description">Description</h2>
<p>DeskPi Mini Cube for Raspberry Pi CM4 is a case with a miniature appearance and extremely portable features.</p>
<blockquote>
<p>Note: Only supports Raspberry Pi CM4 module</p>
</blockquote>
<p>The device provides a mini aluminum alloy radiator and integrates a silent fan that supports PWM speed regulation.</p>
<p>The bottom board provides a wealth of interfaces, supporting dual full-size HDMI interfaces, RJ45 Ethernet interfaces, 2x OTG USB port, and one PCIe interface supports <code>M.2 NVME SSD M-KEY 2242</code> external storage. </p>
<p>The DIP switch on the back provides the special pins needed to configure the Raspberry Pi CM4 module. (On Compute Module 4 EMMC-DISABLE / nRPIBOOT (GPIO 40) must be fitted to switch the ROM to usbboot mode.)</p>
<p>Otherwise, the SPI EEPROM bootloader image will be loaded instead.</p>
<p>The 40Pin GPIO lead out and reserved RTC clock battery interface.</p>
<h2 id="features">Features</h2>
<ul>
<li>Integrated design</li>
<li>Aluminum alloy radiator with PWM adjustable speed fan</li>
<li>Power button</li>
<li>2 x Full-size HDMI ports</li>
<li>2 x OTG USB2.0 port</li>
<li>1 x PCIe M.2 NVME M-KEY 2242 SSD slot </li>
<li>1 x 40 Pin GPIO lead out</li>
<li>1 x DIP switch for mode change (CM4 function change)</li>
<li>1 x Onboard PCF85063 I2C RTC module </li>
<li>5V USB-C Port Power IN</li>
</ul>
<h2 id="gallery">Gallery</h2>
<ul>
<li>
<p>Product Outlook 
<img alt="DeskPi mini cube feature1" src="../imgs/deskpiminicube/DP-0019-1.jpg" /></p>
</li>
<li>
<p>Backside of Mini Cube 
<img alt="DeskPi mini cube feature2" src="../imgs/deskpiminicube/DP-0019-2.jpg" /></p>
</li>
<li>
<p>Ports Definitions
<img alt="DeskPi mini cube feature3" src="../imgs/deskpiminicube/DP-0019-3.jpg" /></p>
</li>
<li>
<p>Inside of Mini Cube<br />
<img alt="DeskPi mini cube feature4" src="../imgs/deskpiminicube/DP-0019-5.jpg" /></p>
</li>
<li>
<p>Dimension
<img alt="DeskPi mini cube feature5" src="../imgs/deskpiminicube/DP-0019-7.jpg" /></p>
</li>
<li>
<p>IPX antenna specifications</p>
<ul>
<li>Centre Frequency: 2400-2500MHz &amp; 4900-5900MHz</li>
<li>Connector: IPEX1</li>
<li>Lead Length:  </li>
<li>Antenna Element Length:  mm (+/- 1mm)</li>
<li>Antenna Element Cable: 1.13 Coaxial cable, with plastic coating.</li>
<li>Impedance: 5Ohm.</li>
<li>Gain: About 3 dBi.
<img alt="IPEX1 Antenna" src="../imgs/deskpiminicube/DP-0019-11.jpg" /></li>
</ul>
</li>
</ul>
<h3 id="install-ipex-antenna">Install IPEX Antenna</h3>
<p>Add the antenna as following figure, and then remove the protection film on back of the antenna, and then paste it inside the case. 
<img alt="Install Antenna" src="../imgs/deskpiminicube/DP-0019-13.jpg" /></p>
<h2 id="rtc-battery-information">RTC Battery Information</h2>
<p>ear RTC Battery <code>dose not</code> include in the package, additional purchase required! 
* Fit for: laptop CMOS Battery, Recommended <code>CR1220 3V</code> with <code>ZH1.25</code> Connector.</p>
<h2 id="package-includes">Package Includes</h2>
<ul>
<li>1 x DeskPi Mini Cube for Raspberry Pi computer module 4
<img alt="DeskPi mini cube feature6" src="../imgs/deskpiminicube/DP-0019-4.jpg" /></li>
</ul>
<h2 id="how-to-assemble-it">How to assemble it</h2>
<ul>
<li>Step 1. Unloose four screws on top of mini cube.</li>
<li>Step 2. Remove copper pillar and paste thermal pad on top of Raspberry Pi CM4 module.</li>
</ul>
<blockquote>
<blockquote>
<blockquote>
<p><code>NOTE：Please peel off the protection film on both side of the thermal pad.
and press the Raspberry Pi CM4 module according to following figure, please be ware of the direction and angle when press the Raspberry Pi CM4 module.</code> </p>
</blockquote>
</blockquote>
</blockquote>
<ul>
<li>Step 3. Fix aluminum heat sink to Raspberry Pi CM4 module with copper pillars.</li>
</ul>
<p>Please refer to following figure to assemble it.</p>
<p><img alt="DeskPi mini cube feature4" src="../imgs/deskpiminicube/DP-0019-6.jpg" /></p>
<h3 id="optional-install-m2-nvme-ssd-m-key-22422240">[Optional] Install M.2 NVME SSD M-KEY 2242/2240.</h3>
<ol>
<li>
<p>Remove the screws on bottom of mini cube and remove the PCB which is connected to mainboard on 40Pin GPIO. </p>
</li>
<li>
<p>Insert SSD drive into the slot in 45-degree angle and fix it with screw.  </p>
</li>
<li>
<p>Cover it back to 40Pin GPIO and make sure it connect properly.   </p>
</li>
<li>
<p>Fix the bottom case with screws.
<img alt="DIP Switch Details" src="../imgs/deskpiminicube/DP-0019-8.jpg" /></p>
</li>
</ol>
<h2 id="functionality-of-power-button">Functionality of power button:</h2>
<ul>
<li>Short Press:  <code>Power on</code></li>
<li>Long Press:  <code>Power off (Cutoff power)</code></li>
</ul>
<blockquote>
<p>Please <code>NOTE</code> that if you have not shutdown the system, do not use long press to halt system, it will damage your system, it may cause kernel panic or lost file which are not saved yet. </p>
</blockquote>
<ul>
<li><strong>Correct Operation</strong>:
Shutdown system in terminal or desktop, and then long press the button to cut off power.</li>
</ul>
<h2 id="dip-switch-functionality">DIP Switch Functionality</h2>
<p><img alt="DIP Switch Details" src="../imgs/deskpiminicube/DP-0019-9.jpg" /></p>
<h3 id="dip-switch-pinout">DIP Switch Pinout</h3>
<ul>
<li>1 - USB OTG Pull UP</li>
<li>2 - UNATTENDEND </li>
<li>3 - EEPROM_nWP  (EEPROM write protection)</li>
<li>4.- nRPIBOOT  (disable or enable eMMC Boot)
<img alt="DIP Switch" src="../imgs/deskpiminicube/DP-0019-12.jpg" /></li>
</ul>
<p>If you are using Raspberry Pi CM4 with EMMC onboard. please refer to this URL:
<a href="https://www.raspberrypi.com/documentation/computers/compute-module.html#compute-module-4">How to flash the Compute Module</a> in section <code>“Flashing the Compute Module eMMC”</code> </p>
<p>Hardware write-protection must be <code>enabled</code> via software and then locked by pulling the <code>EEPROM_nWP</code> pin low.</p>
<h2 id="how-to-enable-usb20-ports-besides-the-usb-c-port">How to enable USB2.0 ports besides the USB-C port?</h2>
<p><strong>Assume that you are using Raspberry Pi OS (64bit/32bit).</strong></p>
<ul>
<li>The latest official image which you can download from:
<code>www.raspberrypi.com/software</code> will automatically adding <code>otg_mode=1</code> in
/boot/firmware/config.txt file, so you don't need to modify any parameter in
/boot/firmware/config.txt file.</li>
</ul>
<h2 id="how-to-update-eeprom-on-cm4-by-using-mini-cube">How to update eeprom on CM4 by using mini cube?</h2>
<ul>
<li>This is the USB device boot code which supports the Raspberry Pi 1A, 3A+,
    Computer Module, Computer Module 3,3+,4S and 4, Raspberry Pi Zero and Zero
    2W. N.B. In regards to this document CM4 and CM4S have identical software support.
The default behaviour when run with no arguments is to boot the Raspberry Pi with special firmware so that it emulates USB Mass Storage Device (MSD).
The host OS will treat this as a normal USB mass storage device allowing the file system to be accessed. 
If the storage has not been formatted yet (default for Compute Module) then the Raspberry Pi Imager App can be used to install a new operating system.</li>
</ul>
<p>Since RPIBOOT is a generic firmware loading interface, it is possible to load other versions of the firmware by passing the -d flag to specify the directory where the firmware should be loaded from. E.g. The firmware in the msd can be replaced with newer/older versions.</p>
<p>From Raspberry Pi5 onwards the MSD firmware has been replaced with a Linux initramfs providing a mass-storage-gadget.</p>
<p>For more information run <code>rpiboot -h</code>.</p>
<h3 id="building">Building</h3>
<ul>
<li>Linux / Cygwin / WSL</li>
</ul>
<p>Clone this <a href="https://github.com/raspberrypi/usbboot">repository</a> on your Pi or other Linux machine. 
Make sure that the system date is set correctly, otherwise Git may produce an error.</p>
<p>This git repository uses symlinks. </p>
<p>For Windows builds clone the repository under Cygwin</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>libusb-1.0-0-dev<span class="w"> </span>pkg-config<span class="w"> </span>build-essential
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>https://github.com/raspberrypi/usbboot
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">cd</span><span class="w"> </span>usbboot
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>make
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>sudo<span class="w"> </span>./rpiboot
</span></code></pre></div>
<p>sudo isn't required if you have write permissions for the /dev/bus/usb device.</p>
<h3 id="macos">macOS</h3>
<p>From a macOS machine, you can also run usbboot, just follow the same steps:</p>
<ul>
<li>Clone the usbboot repository</li>
<li>Install libusb (brew install libusb)</li>
<li>Install pkg-config (brew install pkg-config)</li>
<li>(Optional) Export the PKG_CONFIG_PATH so that it includes the directory enclosing libusb-1.0.pc</li>
<li>Build using make</li>
<li>Run the binary</li>
</ul>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>https://github.com/raspberrypi/usbboot
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>usbboot
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>brew<span class="w"> </span>install<span class="w"> </span>libusb
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>brew<span class="w"> </span>install<span class="w"> </span>pkg-config
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>make
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>sudo<span class="w"> </span>./rpiboot
</span></code></pre></div>
If the build is unable to find the header file libusb.h then most likely the PKG_CONFIG_PATH is not set properly. This should be set via export PKG_CONFIG_PATH="$(brew --prefix libusb)/lib/pkgconfig".</p>
<p>If the build fails on an ARM-based Mac with a linker error such as ld: warning: ignoring file /usr/local/Cellar/libusb/1.0.26/lib/libusb-1.0.dylib, building for macOS-arm64 but attempting to link with file built for macOS-x86_64 then you may need to build and install libusb-1.0 yourself:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$<span class="w"> </span>wget<span class="w"> </span>https://github.com/libusb/libusb/releases/download/v1.0.26/libusb-1.0.26.tar.bz2
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>$<span class="w"> </span>tar<span class="w"> </span>-xf<span class="w"> </span>libusb-1.0.26.tar.bz2
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>libusb-1.0.26
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>$<span class="w"> </span>./configure
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>$<span class="w"> </span>make
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>$<span class="w"> </span>make<span class="w"> </span>check
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>$<span class="w"> </span>sudo<span class="w"> </span>make<span class="w"> </span>install
</span></code></pre></div>
Running make again should now succeed.</p>
<h3 id="running">Running</h3>
<ul>
<li>
<p>Compute Module 3
Fit the EMMC-DISABLE jumper on the Compute Module IO board before powering on the board or connecting the USB cable.</p>
</li>
<li>
<p>Compute Module 4
On Compute Module 4 EMMC-DISABLE / nRPIBOOT (GPIO 40) must be fitted to switch the ROM to usbboot mode. Otherwise, the SPI EEPROM bootloader image will be loaded instead.</p>
</li>
</ul>
<p>Connect the USB-C cable (from the RPIBOOT host to the MiniCube)</p>
<h2 id="compute-module-4-update-the-spi-eeprom-bootloader">Compute Module 4 Update the SPI EEPROM bootloader.</h2>
<p>To update the SPI EEPROM bootloader on a Compute Module 4.</p>
<ul>
<li>Modify the EEPROM configuration as desired</li>
<li>Optionally, replace pieeprom.original.bin with a custom version. The default
  version here is the latest stable release recommended for use on Compute Module 4.</li>
</ul>
<p>N.B The <code>bootcode4.bin</code> file in this directory is actually the <code>recovery.bin</code>
file used on Raspberry Pi 4 bootloader update cards.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">cd</span><span class="w"> </span>recovery
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>./update-pieeprom.sh
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>../rpiboot<span class="w"> </span>-d<span class="w"> </span>.
</span></code></pre></div>
<h2 id="booting-linux">Booting Linux</h2>
<p>The <code>RPIBOOT</code> protocol provides a virtual file system to the Raspberry Pi bootloader and GPU firmware. It's therefore possible to
boot Linux. To do this, you will need to copy all of the files from a Raspberry Pi boot partition plus create your own
initramfs.
On Raspberry Pi 4 / CM4 the recommended approach is to use a <code>boot.img</code> which is a FAT disk image containing
the minimal set of files required from the boot partition.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>This section describes how to diagnose common <code>rpiboot</code> failures for Compute Modules. Whilst <code>rpiboot</code> is tested on every Compute Module during manufacture the system relies on multiple hardware and software elements. 
The aim of this guide is to make it easier to identify which component is failing.</p>
<h3 id="hardware">Hardware</h3>
<ul>
<li>Inspect the Compute Module pins and connector for signs of damage and verify that the socket is free from debris.</li>
<li>Check that the Compute Module is fully inserted.</li>
<li>Check that <code>nRPIBOOT</code> / EMMC disable is pulled low BEFORE powering on the device.</li>
<li>On BCM2711, if the USB cable is disconected and the nRPIBOOT jumper is fitted then the green LED should be OFF. If the LED is on then the ROM is detecting that the GPIO for nRPIBOOT is high.</li>
<li>Remove any hubs between the Compute Module and the host.</li>
<li>Disconnect all other peripherals from the IO board.</li>
<li>Verify that the red power LED switches on when the IO board is powered.</li>
<li>Use another computer to verify that the USB cable for <code>rpiboot</code> can reliably transfer data. For example, connect it to a Raspberry Pi keyboard with other devices connected to the keyboard USB hub.</li>
</ul>
<h4 id="hardware-cm4">Hardware - CM4</h4>
<ul>
<li>The CM4 EEPROM supports MMC, USB-MSD, USB 2.0, Network and NVMe boot by default. Try booting to Linux from an alternate boot mode (e.g. network) to verify the <code>nRPIBOOT</code> GPIO can be pulled low and that the USB 2.0 interface is working.</li>
<li>If <code>rpiboot</code> is running but the mass storage device does not appear then try running the <code>rpiboot -d mass-storage-gadget</code> because this uses Linux instead of a custom VPU firmware to implement the mass-storage gadget. This also provides a login console on UART and HDMI.</li>
</ul>
<h3 id="software">Software</h3>
<p>The recommended host setup is Raspberry Pi with Raspberry Pi OS. Alternatively, most Linux X86 builds are also suitable. Windows adds some extra complexity for the USB drivers so we recommend debugging on Linux first.</p>
<ul>
<li>Update to the latest software release using <code>apt update rpiboot</code> or download and rebuild this repository from Github.</li>
<li>Run <code>rpiboot -v | tee log</code> to capture verbose log output. N.B. This can be very verbose on some systems.</li>
</ul>
<h4 id="bootcodebin">bootcode.bin</h4>
<p>Be careful not to overwrite <code>bootcode.bin</code> or <code>bootcode4.bin</code> with the executable from a different subdirectory. The <code>rpiboot</code> process simply looks for a file called <code>bootcode.bin</code> (or <code>bootcode4.bin</code> on BCM2711). However, the file in <code>recovery</code>/<code>secure-boot-recovery</code> directories is actually the <code>recovery.bin</code> EEPROM flashing tool.</p>
<h2 id="how-to-enable-fan-automatically">How to enable fan automatically?</h2>
<p><strong> Assume that your operating system is Raspberry Pi OS (32bit/64bit) </strong></p>
<h3 id="official-fan-setting">Official Fan setting</h3>
<ul>
<li>Open a terminal and typing following command:</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo raspi-config 
</span></code></pre></div>
<p>Navigate to <code>Performance Options</code> -&gt; <code>P4 Fan</code> -&gt; <code>Yes</code> -&gt; <code>14</code> -&gt; <code>60</code> -&gt; <code>yes</code> -&gt; <code>finish</code> -&gt; reboot Raspberry Pi.</p>
<p>The fan is support <code>PWM</code> signal control via <code>GPIO14</code> which is <code>physical pin 12</code>(TXD), it will spinning when the CPU temperature is above <code>60</code> degree.</p>
<p>and also you can write your code to control the fan via <code>GPIO14</code>, sending <code>PWM</code> signal will trigger the fan spinning.</p>
<h3 id="control-fan-manually">Control Fan manually</h3>
<h4 id="demo-code">Demo code</h4>
<ul>
<li>Here is a demo code for controlling fan speed by using python script.</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a> <span class="c1">#!/usr/bin/python3</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="n">pwm</span> <span class="o">=</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Press Ctrl+C to quit </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="n">dc</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="n">pwm</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="k">try</span><span class="p">:</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="n">temp</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;vcgencmd measure_temp|sed &#39;s/[^0-9.]//g&#39;&quot;</span><span class="p">)</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">45</span><span class="p">:</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>            <span class="n">dc</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>            <span class="n">pwm</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CPU Temp:&quot;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="s2">&quot; Fan duty cycle:&quot;</span><span class="p">,</span><span class="n">dc</span><span class="p">)</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">180.0</span><span class="p">)</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>            <span class="n">dc</span> <span class="o">=</span> <span class="mi">85</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>            <span class="n">pwm</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CPU Temp:&quot;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="s2">&quot; Fan duty cycle:&quot;</span><span class="p">,</span><span class="n">dc</span><span class="p">)</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">120.0</span><span class="p">)</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>            <span class="n">dc</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>            <span class="n">pwm</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CPU Temp:&quot;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="s2">&quot; Fan duty cycle:&quot;</span><span class="p">,</span><span class="n">dc</span><span class="p">)</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">60.00</span><span class="p">)</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>    <span class="n">pwm</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>    <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ctrl + C pressed -- Ending program&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Then execute it:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>python3 fan_control.py
</span></code></pre></div>
<h2 id="how-to-enable-onboard-rtc-module">How to enable onboard RTC module?</h2>
<blockquote>
<p><code>NOTE</code>:<br />
RTC battery sock type: ZH1.25<br />
The battery dose not include in the package, additional purchase required!!
* Step 1. Modify /boot/config.txt file and adding following parameter:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nv">dtoverlay</span><span class="o">=</span>i2c-rtc,pcf85063a,i2c_csi_dsi,addr<span class="o">=</span>0x51
</span></code></pre></div>
Save it and please reboot your Raspberry Pi. </p>
</blockquote>
<ul>
<li>Step 2. Check if RTC module has been recognized by Raspberry Pi.
Execute following command in a terminal:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>dmesg<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>i2c<span class="w"> </span>
</span></code></pre></div>
<img alt="DMESG infor" src="../imgs/deskpiminicube/dmesg_infor.png" />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>i2cdetect<span class="w"> </span>-y<span class="w"> </span><span class="m">10</span><span class="w"> </span>
</span></code></pre></div><blockquote>
<p>NOTE: if command not found, please install <code>i2c-tools</code>:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>sudo<span class="w"> </span>apt<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>i2c-tool
</span></code></pre></div>
<img alt="I2C infor1" src="../imgs/deskpiminicube/i2c_rtc_01.png" /></p>
</blockquote>
</li>
<li>
<p>Step 3. Probe the module <code>rtc-pcf85063</code> and check the kernel module status.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>modprobe<span class="w"> </span>rtc-pcf85063
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>lsmod<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>rtc<span class="w"> </span>
</span></code></pre></div>
<img alt="I2C infor2" src="../imgs/deskpiminicube/i2c_rtc_02.png" /></p>
</li>
<li>
<p>Step 4. Setting system date and sychronized system time to Hardware clock time.</p>
</li>
</ul>
<p>** Check RTC time in command line.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>cat<span class="w"> </span>/proc/driver/rtc<span class="w"> </span>
</span></code></pre></div></p>
<p><strong> Setting system time
</strong>Syntax**
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>date<span class="w"> </span><span class="o">[</span>-u<span class="p">|</span>--utc<span class="p">|</span>--universal<span class="o">]</span><span class="w"> </span><span class="o">[</span>MMDDhhmm<span class="o">[[</span>CC<span class="o">]</span>YY<span class="o">][</span>.ss<span class="o">]]</span>
</span></code></pre></div>
For example:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>date<span class="w"> </span>-s<span class="w"> </span><span class="s1">&#39;tue oct 18 08:50:23 BST 2022&#39;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>or<span class="w"> </span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>sudo<span class="w"> </span>date<span class="w"> </span><span class="m">053118062023</span>.22<span class="w"> </span>
</span></code></pre></div>
It means setting system time to 2023.05.31 18:06:23. </p>
<p><strong> Sychronizing system time to HW clock time.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>sudo<span class="w"> </span>hwclock<span class="w"> </span>-w
</span></code></pre></div>
</strong> Check RTC time and system time
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>sudo<span class="w"> </span>hwclock<span class="w"> </span><span class="p">;</span><span class="w"> </span>date
</span></code></pre></div></p>
<h2 id="faq">FAQ</h2>
<ul>
<li>Q: Dose it support NVMe SSD booting? <br />
A: It has been tested, yes, it supports, but you may need to upgrade eeprom by using rpi-boot from official github repository. </li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../deskpi_lite_for_3b/" class="btn btn-neutral float-left" title="DeskPi Lite For Raspberry Pi 3B/3B+"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../picomate/" class="btn btn-neutral float-right" title="DeskPi PicoMate">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../deskpi_lite_for_3b/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../picomate/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
